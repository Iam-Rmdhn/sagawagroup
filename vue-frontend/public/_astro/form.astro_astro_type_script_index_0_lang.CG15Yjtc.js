const e={"Kagawa Coffee Corner":{original:1e8,discounted:89e6},"Kagawa Ricebowl":{original:75e6,discounted:5e7},"Kagawa Coffee & Ricebowl Corner":{original:175e6,discounted:139e6},"RM Nusantara (WarNas/WarTeg, Mas Gaw & RMÂ Sunda)":{original:1e8,discounted:89e6}},t=.05,n=new Date,a=parseInt(n.getDate().toString()+(n.getMonth()+1).toString().padStart(2,"0")+n.getFullYear().toString().slice(-2));let i="",s=0,r="",o=null;function l(){o&&clearTimeout(o),o=setTimeout(()=>{d()},100)}function d(){const e=document.getElementById("nextBtn");if(!e)return;const t=[{name:"sistemKemitraan",type:"radio"},{name:"paketUsaha",type:"select"},{name:"namaMitra",type:"input"},{name:"alamatMitra",type:"input"},{name:"noHp",type:"input"},{name:"email",type:"input"},{name:"nilaiPaket",type:"radio"},{name:"namaPengirim",type:"input"},{name:"noRekPengirim",type:"input"},{name:"bankPengirim",type:"input"}];let n=!0,a=[],i={};for(const d of t){let e=!1,t="",s=null;if("radio"===d.type){const n=document.querySelectorAll(`input[name="${d.name}"]:checked`);e=n.length>0,t=n.length>0?n[0].value:"",s=n[0]||document.querySelector(`input[name="${d.name}"]`)}else if("select"===d.type){const n=document.getElementById(d.name);s=n,t=n?.value||"",e=""!==t.trim()&&"Pilih Paket Usaha"!==t&&""!==t}else{const n=document.getElementById(d.name);s=n,t=n?.value||"",e=""!==t.trim()}i[d.name]={value:t,isValid:e,element:s?"found":"NOT FOUND",actualValue:t||"EMPTY"},e||(n=!1,a.push(d.name))}const s=document.getElementById("documentsUpload"),r=document.getElementById("buktiTransfer"),o=s?.files&&s.files.length>0,l=r?.files&&r.files.length>0;o||(n=!1,a.push("documents")),l||(n=!1,a.push("buktiTransfer")),n?(e.disabled=!1,e.classList.remove("bg-gray-400","cursor-not-allowed"),e.classList.add("bg-gray-800","hover:bg-gray-700","cursor-pointer")):(e.disabled=!0,e.classList.remove("bg-gray-800","hover:bg-gray-700","cursor-pointer"),e.classList.add("bg-gray-400","cursor-not-allowed"))}function c(e){const t=document.getElementById("documentsPreview"),n=document.getElementById("documentsFileList");if(!e||0===e.length)return void t?.classList.add("hidden");t?.classList.remove("hidden"),n&&(n.innerHTML="");const a=e[0];if(a.size>2097152){alert("Ukuran file terlalu besar. Maksimal 2MB per file.");const e=document.getElementById("documentsUpload");return e&&(e.value=""),void t?.classList.add("hidden")}const i=document.createElement("div");i.className="flex items-center justify-between p-3 bg-blue-50 rounded-lg";const s=document.createElement("div");s.className="flex items-center space-x-3";const r=document.createElement("div");r.className="w-8 h-8 bg-blue-100 rounded flex items-center justify-center",r.innerHTML='<svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 1H7a2 2 0 00-2 2v16a2 2 0 002 2z"></path></svg>';const o=document.createElement("div");o.innerHTML=`\n    <p class="text-sm font-medium text-gray-800">Foto KTP: ${a.name}</p>\n    <p class="text-xs text-gray-500">${u(a.size)}</p>\n  `,s.appendChild(r),s.appendChild(o);const l=document.createElement("button");l.type="button",l.className="text-red-500 hover:text-red-700",l.setAttribute("data-action","remove-document"),l.setAttribute("data-index","0"),l.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',i.appendChild(s),i.appendChild(l),n?.appendChild(i)}function m(e){const t=document.getElementById("buktiTransferPreview"),n=document.getElementById("buktiTransferInfo");e?(t?.classList.remove("hidden"),n&&(n.innerHTML=`\n      <div class="flex items-center justify-between">\n        <div class="flex items-center space-x-3">\n          <div class="w-8 h-8 bg-green-100 rounded flex items-center justify-center">\n            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 1H7a2 2 0 00-2 2v16a2 2 0 002 2z"></path>\n            </svg>\n          </div>\n          <div>\n            <p class="text-sm font-medium text-gray-800">${e.name}</p>\n            <p class="text-xs text-gray-500">${u(e.size)}</p>\n          </div>\n        </div>\n        <button type="button" data-action="remove-bukti-transfer" class="text-red-500 hover:text-red-700">\n          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n          </svg>\n        </button>\n      </div>\n    `)):t?.classList.add("hidden")}function u(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function g(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e).replace("IDR","Rp.")}window.performValidation=d,document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("documentsUpload"),t=document.getElementById("buktiTransfer"),n=document.getElementById("documentsUploadBtn"),a=document.getElementById("buktiTransferUploadBtn");n?.addEventListener("click",()=>{e?.click()}),a?.addEventListener("click",()=>{t?.click()}),e?.addEventListener("change",function(){c(this.files);const e=document.getElementById("documentsUploadArea");e&&(this.files&&this.files.length>0?(e.classList.remove("border-gray-300"),e.classList.add("border-green-400","bg-green-50")):(e.classList.remove("border-green-400","bg-green-50"),e.classList.add("border-gray-300"))),l()}),t?.addEventListener("change",function(){const e=this.files?.[0]||null;m(e);const t=document.getElementById("buktiTransferUploadArea");t&&(e?(t.classList.remove("border-gray-300"),t.classList.add("border-green-400","bg-green-50")):(t.classList.remove("border-green-400","bg-green-50"),t.classList.add("border-gray-300"))),l()});const i=document.getElementById("checkFormBtn");i?.addEventListener("click",()=>{d()});["#paketUsaha","#sales","#namaMitra","#alamatMitra","#noHp","#email","#namaPengirim","#noRekPengirim","#bankPengirim"].forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.addEventListener("change",l),e.addEventListener("input",l),"SELECT"===e.tagName&&e.addEventListener("blur",l)})}),document.querySelectorAll('input[name="sistemKemitraan"]').forEach(e=>{e.addEventListener("change",function(){l()})}),document.querySelectorAll('input[name="nilaiPaket"]').forEach(e=>{e.addEventListener("change",function(){l()})}),l(),document.addEventListener("click",function(e){const t=e.target;if(t.closest('[data-action="remove-bukti-transfer"]')&&(e.preventDefault(),function(){const e=document.getElementById("buktiTransfer");e&&(e.value="",m(null)),l()}()),t.closest('[data-action="remove-document"]')){e.preventDefault();!function(e){const t=document.getElementById("documentsUpload");if(!t)return;const n=new DataTransfer;Array.from(t.files||[]).forEach((t,a)=>{a!==e&&n.items.add(t)}),t.files=n.files,c(t.files)}(parseInt(t.closest('[data-action="remove-document"]')?.getAttribute("data-index")||"0"))}})});const p=document.getElementById("paketUsaha");function f(){if(!s)return;const e=Math.floor(s*t),n=s-a,i=s-e,o=document.getElementById("dp-amount");o&&(o.textContent=g(e));const l=document.getElementById("original-price"),d=document.getElementById("discounted-price");l&&(l.textContent=g(s)),d&&(d.textContent=g(n));const c=document.getElementById("kekurangan-amount");c&&(c.textContent=g(i));let m=0;const u=document.getElementById("dp-card"),p=document.getElementById("full-card"),f=document.getElementById("kekurangan-card");"DP"===r?(m=e-a,u?.classList.remove("opacity-50"),p?.classList.add("opacity-50"),f?.classList.remove("opacity-50")):"Full Payment"===r&&(m=n,u?.classList.add("opacity-50"),p?.classList.remove("opacity-50"),f?.classList.add("opacity-50"));const y=document.getElementById("final-payment");y&&(y.textContent=g(Math.max(0,m)))}p?.addEventListener("change",function(){i=this.value;const t=e[i];s=t?t.discounted:0,function(e){const t=document.getElementById("priceDisplay"),n=document.getElementById("originalPrice"),a=document.getElementById("discountedPrice"),i=document.getElementById("savingsAmount");if(!(e&&t&&n&&a&&i))return void t?.classList.add("hidden");const s=e.original-e.discounted;n.textContent=g(e.original),a.textContent=g(e.discounted),i.textContent=g(s),t.classList.remove("hidden")}(t),f(),l()}),document.querySelectorAll('input[name="nilaiPaket"]').forEach(e=>{e.addEventListener("change",function(){r=this.value,f(),l()})});const y=document.getElementById("nextBtn");y?.addEventListener("click",function(){(function(){const e=["sistemKemitraan","paketUsaha","namaMitra","alamatMitra","noHp","email","nilaiPaket","namaPengirim","noRekPengirim","bankPengirim"];for(let r of e){let e=null;if(e="sistemKemitraan"===r||"nilaiPaket"===r?document.querySelector(`input[name="${r}"]:checked`):document.getElementById(r),!e||!e.value.trim())return alert(`Field ${r} harus diisi`),"sistemKemitraan"!==r&&"nilaiPaket"!==r&&(e=document.getElementById(r),e?.focus()),!1}const t=document.getElementById("documentsUpload"),n=document.getElementById("buktiTransfer");if(!t?.files?.length)return alert("Silakan upload dokumen KTP, NPWP & foto diri mitra"),document.getElementById("documentsUploadArea")?.scrollIntoView({behavior:"smooth"}),!1;if(!n?.files?.length)return alert("Silakan upload bukti transfer"),document.getElementById("buktiTransferUploadArea")?.scrollIntoView({behavior:"smooth"}),!1;const a=["image/jpeg","image/jpg","image/png","application/pdf"],i=5242880;for(let r=0;r<t.files.length;r++){const e=t.files[r];if(!a.includes(e.type))return alert(`File ${e.name} tidak didukung. Gunakan format JPG, PNG, atau PDF`),!1;if(e.size>i)return alert(`File ${e.name} terlalu besar. Maksimal 5MB per file`),!1}const s=n.files[0];if(!a.includes(s.type))return alert("File bukti transfer tidak didukung. Gunakan format JPG, PNG, atau PDF"),!1;if(s.size>i)return alert("File bukti transfer terlalu besar. Maksimal 5MB"),!1;return!0})()&&(!function(){const n=function(n){const i=Math.floor(s*t),r=s-a,o="DP"===n.nilaiPaket?i-a:r,l=e[n.paketUsaha],d=l?l.original:s;let c="";if(n.documentsFiles&&n.documentsFiles.length>0){const e=n.documentsFiles[0];c=`\n      <div class="flex items-center space-x-2">\n        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 1H7a2 2 0 00-2 2v16a2 2 0 002 2z"></path>\n        </svg>\n        <span class="text-sm text-gray-600">Foto KTP: ${e.name} (${u(e.size)})</span>\n      </div>\n    `}return`\n    <div class="space-y-6">\n      <div class="bg-gray-50 p-4 rounded-lg">\n        <h3 class="font-semibold text-gray-800 mb-2">Sistem Kemitraan</h3>\n        <p class="text-gray-600">${n.sistemKemitraan}</p>\n        <p class="text-gray-600">PIC/Sales: ${n.sales}</p>\n      </div>\n      \n      <div class="bg-gray-50 p-4 rounded-lg">\n        <h3 class="font-semibold text-gray-800 mb-2">Paket Usaha</h3>\n        <p class="text-gray-600">${n.paketUsaha}</p>\n        <p class="text-gray-600">\n          Harga: <span style="text-decoration: line-through; color: #999;">${g(d)}</span> \n          <strong style="color: #dc2626;">${g(s)}</strong>\n        </p>\n      </div>\n      \n      <div class="bg-gray-50 p-4 rounded-lg">\n        <h3 class="font-semibold text-gray-800 mb-2">Data Diri Mitra</h3>\n        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n          <div>\n            <label class="text-sm font-medium text-gray-600">Nama:</label>\n            <input type="text" value="${n.namaMitra}" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" id="confirm-nama">\n          </div>\n          <div>\n            <label class="text-sm font-medium text-gray-600">Email:</label>\n            <input type="email" value="${n.email}" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" id="confirm-email">\n          </div>\n          <div>\n            <label class="text-sm font-medium text-gray-600">Alamat:</label>\n            <input type="text" value="${n.alamatMitra}" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" id="confirm-alamat">\n          </div>\n          <div>\n            <label class="text-sm font-medium text-gray-600">No HP:</label>\n            <input type="tel" value="${n.noHp}" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" id="confirm-hp">\n          </div>\n        </div>\n      </div>\n      \n      <div class="bg-gray-50 p-4 rounded-lg">\n        <h3 class="font-semibold text-gray-800 mb-2">Dokumen Terupload</h3>\n        <div class="space-y-2">\n          <div>\n            <p class="text-sm font-medium text-gray-700">Dokumen KTP:</p>\n            <div class="ml-4 space-y-1">\n              ${c}\n            </div>\n          </div>\n          <div>\n            <p class="text-sm font-medium text-gray-700">Bukti Transfer:</p>\n            <div class="ml-4 flex items-center space-x-2">\n              <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 1H7a2 2 0 00-2 2v16a2 2 0 002 2z"></path>\n              </svg>\n              <span class="text-sm text-gray-600">${n.buktiTransferFile?`${n.buktiTransferFile.name} (${u(n.buktiTransferFile.size)})`:"Tidak ada"}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class="bg-gray-50 p-4 rounded-lg">\n        <h3 class="font-semibold text-gray-800 mb-2">Pembayaran</h3>\n        <p class="text-gray-600">Metode: ${n.nilaiPaket}</p>\n        <p class="text-lg font-semibold text-blue-600">Total Bayar: ${g(Math.max(0,o))}</p>\n      </div>\n      \n      <div class="bg-gray-50 p-4 rounded-lg">\n        <h3 class="font-semibold text-gray-800 mb-2">Sumber Dana</h3>\n        <p class="text-gray-600">Nama: ${n.namaPengirim}</p>\n        <p class="text-gray-600">No Rekening: ${n.noRekPengirim}</p>\n        <p class="text-gray-600">Bank: ${n.bankPengirim}</p>\n      </div>\n    </div>\n  `}(b()),i=document.getElementById("confirmationData");i&&(i.innerHTML=n);const r=document.getElementById("form-step-1"),o=document.getElementById("form-step-2");r&&o&&(r.classList.add("hidden"),o.classList.remove("hidden"))}(),k(2))});const v=document.getElementById("backBtn");v?.addEventListener("click",function(){const e=document.getElementById("form-step-1"),t=document.getElementById("form-step-2");t?.classList.add("hidden"),e?.classList.remove("hidden"),k(1)});const h=document.getElementById("submitBtn");function b(){const e=document.querySelector('input[name="sistemKemitraan"]:checked'),t=document.getElementById("sales"),n=document.getElementById("paketUsaha"),a=document.getElementById("namaMitra"),i=document.getElementById("alamatMitra"),s=document.getElementById("noHp"),r=document.getElementById("email"),o=document.querySelector('input[name="nilaiPaket"]:checked'),l=document.getElementById("namaPengirim"),d=document.getElementById("noRekPengirim"),c=document.getElementById("bankPengirim"),m=document.getElementById("documentsUpload"),u=document.getElementById("buktiTransfer");return{sistemKemitraan:e?.value||"",sales:t?.value||"",paketUsaha:n?.value||"",namaMitra:a?.value||"",alamatMitra:i?.value||"",noHp:s?.value||"",email:r?.value||"",nilaiPaket:o?.value||"",namaPengirim:l?.value||"",noRekPengirim:d?.value||"",bankPengirim:c?.value||"",documentsFiles:m?.files||null,buktiTransferFile:u?.files?.[0]||null}}function k(e){for(let t=1;t<=3;t++){const n=document.getElementById(`step-${t}`),a=n?.nextElementSibling;n&&a&&(t<=e?(n.classList.remove("bg-gray-300","text-gray-600"),n.classList.add("bg-blue-600","text-white"),a.classList.remove("text-gray-600"),a.classList.add("text-blue-600")):(n.classList.remove("bg-blue-600","text-white"),n.classList.add("bg-gray-300","text-gray-600"),a.classList.remove("text-blue-600"),a.classList.add("text-gray-600")))}}h?.addEventListener("click",async function(){await async function(){try{const n=b(),i=document.getElementById("confirm-nama"),r=document.getElementById("confirm-email"),o=document.getElementById("confirm-alamat"),l=document.getElementById("confirm-hp");n.namaMitra=i?.value||n.namaMitra,n.email=r?.value||n.email,n.alamatMitra=o?.value||n.alamatMitra,n.noHp=l?.value||n.noHp,n.bankPengirim=await async function(e){return{}[e.toLowerCase()]||e}(n.bankPengirim);const d=Math.floor(s*t),c=s-a,m="DP"===n.nilaiPaket?d-a:c,u=new FormData;["sistemKemitraan","paketUsaha","namaMitra","alamatMitra","noHp","email","nilaiPaket","namaPengirim","noRekPengirim","bankPengirim","sales"].forEach(e=>{n[e]&&"string"==typeof n[e]&&u.append(e,n[e])}),u.append("jenisUsaha",n.sales||"");const g=e[n.paketUsaha],p=g?g.original:s;u.append("hargaPaket",s.toString()),u.append("hargaAsli",p.toString()),u.append("nominalDP",d.toString()),u.append("nominalFull",c.toString()),u.append("kekurangan",(s-d).toString()),u.append("diskonHarian",a.toString()),u.append("yangHarusDibayar",Math.max(0,m).toString()),n.documentsFiles&&n.documentsFiles.length>0&&u.append("documents",n.documentsFiles[0]),n.buktiTransferFile&&u.append("buktiTransfer",n.buktiTransferFile);const f="http://localhost:4000",y=await fetch(`${f}/api/mitra/register`,{method:"POST",body:u}),v=await y.text();if(!y.ok){const e=v?JSON.parse(v):{},t=e.error||e.details||"Gagal mengirim formulir";throw new Error(t)}k(3),document.getElementById("form-step-2")?.classList.add("hidden"),document.getElementById("form-step-3")?.classList.remove("hidden")}catch(n){const e=n instanceof Error?n.message:"Terjadi kesalahan saat mengirim formulir";alert(`Error: ${e}`)}}();const n=document.getElementById("form-step-2"),i=document.getElementById("form-step-3");n?.classList.add("hidden"),i?.classList.remove("hidden"),k(3)});
